light:
  - platform: monochromatic
    output: backlight_pwm
    name: Display Backlight
    id: backlight
    restore_mode: ALWAYS_ON

output:
  - platform: ledc
    pin: GPIO21
    id: backlight_pwm

spi:
  - id: spi_tft
    clk_pin: GPIO14
    mosi_pin: GPIO13
    miso_pin: GPIO12
  - id: spi_touch
    clk_pin: GPIO25
    mosi_pin: GPIO32
    miso_pin: GPIO39

display:
  - platform: ili9xxx
    model: ili9341
    id: my_display
    spi_id: spi_tft
    cs_pin: GPIO15
    dc_pin: GPIO2
    dimensions: 
      height: 320
      width: 240
    transform: 
      swap_xy: True
      mirror_x: True
      mirror_y: True
    #rotation: 270
    invert_colors: false
    show_test_card: False
    color_palette: 8BIT
    color_order: RGB
    auto_clear_enabled: False
    #lambda: |-
    #  auto t = id(touch)->get_touch();
    #  if (t) // or touch.has_value()
    #    it.filled_circle(t.value().x, t.value().y, 10, ha_yellow);

    

touchscreen:
  - platform: xpt2046
    id: touch
    spi_id: spi_touch
    cs_pin: GPIO33
    transform: 
      swap_xy: False
      mirror_x: True
      mirror_y: False
    calibration: 
      x_max: 3718
      x_min: 187
      y_max: 3799
      y_min: 272
    on_release: 
      then:
        if:
          condition: lvgl.is_paused
          then:
            - logger.log: "LVGL resuming"
            - lvgl.resume:
            - lvgl.widget.redraw:
            - light.turn_on: backlight
